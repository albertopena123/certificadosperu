generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Usuario {
  id                   String        @id @default(cuid())
  nombre               String
  email                String        @unique
  password             String
  rol                  Rol           @default(ADMIN)
  avatar               String?
  activo               Boolean       @default(true)
  ultimoAcceso         DateTime?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  certificadosEmitidos Certificado[] @relation("CertificadoEmitidoPor")
  cursosCreados        Curso[]       @relation("CursoCreador")
}

model Categoria {
  id          String   @id @default(cuid())
  nombre      String
  slug        String   @unique
  descripcion String?
  icono       String?
  color       String?
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  cursos      Curso[]
}

model Curso {
  id                String        @id @default(cuid())
  nombre            String
  slug              String        @unique
  descripcion       String
  descripcionCorta  String?
  tipo              TipoCurso
  modalidad         Modalidad
  horasAcademicas   Int
  horasCronologicas Int?
  creditos          Float?
  precio            Float
  precioOriginal    Float?
  imagen            String?
  temario           Json          @default("[]")
  objetivos         Json          @default("[]")
  requisitos        Json          @default("[]")
  dirigidoA         Json          @default("[]")
  activo            Boolean       @default(true)
  destacado         Boolean       @default(false)
  fechaInicio       DateTime?
  fechaFin          DateTime?
  cupoMaximo        Int?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  categoriaId       String
  creadorId         String
  certificados      Certificado[]
  categoria         Categoria     @relation(fields: [categoriaId], references: [id])
  creador           Usuario       @relation("CursoCreador", fields: [creadorId], references: [id])
  inscripciones     Inscripcion[]
}

model Participante {
  id              String        @id @default(cuid())
  nombreCompleto  String
  tipoDocumento   TipoDocumento
  numeroDocumento String        @unique
  email           String        @unique
  password        String
  telefono        String?
  direccion       String?
  departamento    String?
  provincia       String?
  distrito        String?
  ocupacion       String?
  centroTrabajo   String?
  activo          Boolean       @default(true)
  emailVerificado Boolean       @default(false)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  certificados    Certificado[]
  inscripciones   Inscripcion[]
}

model Inscripcion {
  id               String            @id @default(cuid())
  estado           EstadoInscripcion @default(PENDIENTE)
  fechaInscripcion DateTime          @default(now())
  fechaPago        DateTime?
  metodoPago       String?
  comprobante      String?
  monto            Float
  notas            String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  participanteId   String
  cursoId          String
  curso            Curso             @relation(fields: [cursoId], references: [id])
  participante     Participante      @relation(fields: [participanteId], references: [id])

  @@unique([participanteId, cursoId])
}

model Certificado {
  id                   String            @id @default(cuid())
  codigoVerificacion   String            @unique
  nombreCurso          String
  tipoCurso            TipoCurso
  modalidad            Modalidad
  horasAcademicas      Int
  horasCronologicas    Int?
  creditos             Float?
  temario              Json              @default("[]")
  fechaInicio          DateTime
  fechaFin             DateTime
  fechaEmision         DateTime          @default(now())
  institucionNombre    String            @default("CertificadosPer√∫")
  institucionRuc       String?
  institucionDireccion String?
  institucionLogo      String?
  firmantes            Json
  estado               EstadoCertificado @default(EMITIDO)
  urlVerificacion      String
  qrCode               String?
  observaciones        String?
  nota                 Float?
  notaLetra            String?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  participanteId       String
  cursoId              String
  emitidoPorId         String
  curso                Curso             @relation(fields: [cursoId], references: [id])
  emitidoPor           Usuario           @relation("CertificadoEmitidoPor", fields: [emitidoPorId], references: [id])
  participante         Participante      @relation(fields: [participanteId], references: [id])
}

model Configuracion {
  id          String   @id @default(cuid())
  clave       String   @unique
  valor       String
  descripcion String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum Rol {
  SUPERADMIN
  ADMIN
  EDITOR
}

enum TipoCurso {
  DIPLOMADO
  CERTIFICADO
  CONSTANCIA
}

enum Modalidad {
  VIRTUAL
  PRESENCIAL
  SEMIPRESENCIAL
}

enum TipoDocumento {
  DNI
  CE
  PASAPORTE
}

enum EstadoInscripcion {
  PENDIENTE
  PAGADO
  CURSANDO
  COMPLETADO
  CANCELADO
}

enum EstadoCertificado {
  EMITIDO
  PENDIENTE
  ANULADO
}
